commands:
    01_add_epel_repo:
        cwd: /tmp
        test: '[ ! -f /etc/yum.repos.d/epel.repo ] && echo "epel repo does not exist"'
        command: 'amazon-linux-extras install epel -y'
    02_supervisor_install:
        cwd: /tmp
        test: '[ ! -f /usr/bin/supervisord ] && echo "supervisor not installed"'
        command: 'yum install -y --enablerepo=epel supervisor'
    03_start_supervisor_on_boot:
        cwd: /tmp
        test: '[ ! -f /etc/systemd/system/multi-user.target.wants/supervisord.service ] && echo "supervisor not set to start on boot"'
        command: 'systemctl enable supervisord'
    04_restart_supervisor:
        command: 'service supervisord restart'
files:
    "/etc/supervisord.d/horizon.ini":
        mode: "000644"
        owner: root
        group: root
        content: |
            [program:horizon]
            process_name=%(program_name)s
            command=php /var/app/current/artisan horizon
            autostart=true
            autorestart=true
            user=webapp
            redirect_stderr=true
            stdout_logfile=/home/webapp/horizon.log
            stopwaitsecs=3600
